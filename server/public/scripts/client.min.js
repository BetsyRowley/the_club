var myApp=angular.module("myApp",["ngRoute"]);myApp.config(["$routeProvider","$locationProvider",function(a,b){b.hashPrefix(""),a.when("/home",{templateUrl:"/views/templates/home.html",controller:"LoginController",controllerAs:"login"}).when("/register",{templateUrl:"/views/templates/register.html",controller:"LoginController",controllerAs:"login"}).when("/dashboard",{templateUrl:"/views/templates/dashboard.html",controller:"DashboardController",controllerAs:"dashboard",resolve:{getuser:["ClubService",function(a){return a.getuser()}]}}).when("/featuredbook",{templateUrl:"/views/templates/featuredbook.html",controller:"FeaturedBookController",controllerAs:"featured",resolve:{getuser:["ClubService",function(a){return a.getuser()}]}}).when("/search",{templateUrl:"/views/templates/search.html",controller:"SearchController",controllerAs:"search",resolve:{getuser:["ClubService",function(a){return a.getuser()}]}}).otherwise({redirectTo:"home"})}]),myApp.controller("DashboardController",["$http","$location","ClubService",function(a,b,c){console.log("checking user");var d=this;d.userObject=c.userObject,d.logout=c.logout}]),myApp.controller("FeaturedBookController",["$http","$location","ClubService",function(a,b,c){console.log("checking user");var d=this;d.userObject=c.userObject,d.logout=c.logout}]),myApp.controller("LoginController",["$http","$location","ClubService",function(a,b,c){var d=this;d.user={username:"",password:"",first:"",last:""},d.message="",d.login=function(){""===d.user.username||""===d.user.password?d.message="Enter your username and password!":(console.log("sending to server...",d.user),a.post("/",d.user).then(function(a){a.data.username?(console.log("success: ",a.data),console.log("redirecting to user page"),b.path("/dashboard")):(console.log("failure: ",a),d.message="Wrong!!")}))},d.registerUser=function(){""===d.user.username||""===d.user.password||""===d.user.first||""===d.user.last?d.message="Please complete all fields!":(console.log("sending to server...",d.user),a.post("/register",d.user).then(function(a){console.log("success"),b.path("/home")},function(a){console.log("error"),d.message="Please try again."}))}}]),myApp.controller("SearchController",["$http","$location","ClubService",function(a,b,c){console.log("checking user");var d=this;d.userObject=c.userObject,d.logout=c.logout,d.bookResults={},d.findBook=function(b){a.get("http://openlibrary.org/search.json?title="+b).then(function(a){d.bookResults.array=a.data.docs,console.log(d.bookResults)})}}]),myApp.factory("ClubService",["$http","$location",function(a,b){console.log("Club Service loaded.");var c={};return{userObject:c,getuser:function(){a.get("/user").then(function(a){a.data.username?(c.userName=a.data.username,console.log("User Data: ",c.userName)):b.path("/home")})},logout:function(){a.get("/user/logout").then(function(a){console.log("logged out"),b.path("/home")})}}}]);